# ChitLaq M1 MVP - Local Development Setup

> **Generated by PROMPT 1.7** - Infrastructure Documentation & Knowledge Transfer  
> **Senior Technical Writer & Infrastructure Architect** - 15+ years system documentation and knowledge transfer experience

## Executive Summary

This local development setup guide provides comprehensive instructions for setting up a complete development environment for the ChitLaq M1 MVP infrastructure. It serves as a step-by-step guide for developers to quickly get started with local development, testing, and debugging.

## Table of Contents
- [Prerequisites](#prerequisites)
- [Environment Setup](#environment-setup)
- [Service Configuration](#service-configuration)
- [Development Tools](#development-tools)
- [Testing Setup](#testing-setup)
- [Debugging Setup](#debugging-setup)
- [Common Issues](#common-issues)

## Prerequisites

### System Requirements

#### Operating System
- **Linux**: Ubuntu 20.04+ or CentOS 8+
- **macOS**: macOS 10.15+ (Catalina or later)
- **Windows**: Windows 10+ with WSL2

#### Hardware Requirements
- **CPU**: 4+ cores
- **RAM**: 8GB+ (16GB recommended)
- **Storage**: 50GB+ free space
- **Network**: Stable internet connection

#### Software Requirements
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **Git**: 2.30+
- **Node.js**: 18+ (for development tools)
- **Python**: 3.8+ (for scripts)

### Installation

#### Docker Installation
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y docker.io docker-compose
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker $USER

# macOS (using Homebrew)
brew install docker docker-compose
brew install --cask docker

# Windows (using WSL2)
# Install Docker Desktop for Windows
# Enable WSL2 integration
```

#### Git Installation
```bash
# Ubuntu/Debian
sudo apt install -y git

# macOS
brew install git

# Windows
# Download from https://git-scm.com/
```

#### Node.js Installation
```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# macOS
brew install node

# Windows
# Download from https://nodejs.org/
```

## Environment Setup

### Repository Setup

#### Clone Repository
```bash
# Clone the repository
git clone https://github.com/chitlaq/chitlaq.git
cd chitlaq

# Checkout development branch
git checkout develop

# Create development branch
git checkout -b feature/your-feature-name
```

#### Environment Configuration
```bash
# Copy environment template
cp env.example .env

# Edit environment variables
nano .env

# Set development-specific variables
NODE_ENV=development
DEBUG=true
LOG_LEVEL=debug
```

### Docker Setup

#### Docker Compose Configuration
```bash
# Use development override
cp docker-compose.override.yml.example docker-compose.override.yml

# Edit development configuration
nano docker-compose.override.yml

# Start development services
docker compose up -d
```

#### Service Verification
```bash
# Check service status
docker compose ps

# Check service logs
docker compose logs --tail=50

# Check service health
curl -s http://localhost:3001/health | jq .
curl -s http://localhost:3002/health | jq .
curl -s http://localhost:3003/health | jq .
curl -s http://localhost:3004/health | jq .
curl -s http://localhost:3005/health | jq .
```

## Service Configuration

### Database Setup

#### PostgreSQL Configuration
```bash
# Connect to database
docker compose exec postgres psql -U postgres

# Create development database
CREATE DATABASE chitlaq_dev;

# Run migrations
docker compose exec postgres psql -U postgres -d chitlaq_dev -f /opt/chitlaq/migrations/001_initial_schema.sql

# Seed development data
docker compose exec postgres psql -U postgres -d chitlaq_dev -f /opt/chitlaq/seed-data/demo-data.sql
```

#### Redis Configuration
```bash
# Connect to Redis
docker compose exec redis redis-cli

# Check Redis status
PING

# Check Redis configuration
CONFIG GET "*"

# Set development-specific configuration
CONFIG SET maxmemory 256mb
CONFIG SET maxmemory-policy allkeys-lru
```

### Application Services

#### API Gateway Setup
```bash
# Check API Gateway configuration
docker compose exec api-gateway cat /app/config.js

# Test API endpoints
curl -s http://localhost:3001/api/health | jq .
curl -s http://localhost:3001/api/users | jq .

# Check API Gateway logs
docker compose logs api-gateway --tail=50
```

#### WebSocket Service Setup
```bash
# Check WebSocket configuration
docker compose exec websocket cat /app/config.js

# Test WebSocket connection
wscat -c ws://localhost:3002/ws -x '{"type":"ping"}'

# Check WebSocket logs
docker compose logs websocket --tail=50
```

#### Feed Service Setup
```bash
# Check Feed service configuration
docker compose exec feed-service cat /app/config.js

# Test feed endpoints
curl -s "http://localhost:3003/feed/home?page=1&limit=10" | jq .

# Check Feed service logs
docker compose logs feed-service --tail=50
```

#### Search Service Setup
```bash
# Check Search service configuration
docker compose exec search-service cat /app/config.js

# Test search endpoints
curl -s "http://localhost:3004/search/users?q=test&page=1&limit=10" | jq .

# Check Search service logs
docker compose logs search-service --tail=50
```

#### Auth Service Setup
```bash
# Check Auth service configuration
docker compose exec auth-service cat /app/config.js

# Test auth endpoints
curl -s http://localhost:3005/auth/status | jq .

# Check Auth service logs
docker compose logs auth-service --tail=50
```

## Development Tools

### Code Editor Setup

#### VS Code Configuration
```bash
# Install VS Code extensions
code --install-extension ms-vscode.vscode-docker
code --install-extension ms-vscode.vscode-json
code --install-extension ms-vscode.vscode-yaml
code --install-extension ms-vscode.vscode-markdown
code --install-extension ms-vscode.vscode-git
```

#### VS Code Settings
```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll": true
  },
  "files.associations": {
    "*.yml": "yaml",
    "*.yaml": "yaml"
  },
  "docker.defaultRegistryPath": "localhost:5000"
}
```

### Development Scripts

#### Service Management Scripts
```bash
# Start all services
./scripts/dev-start.sh

# Stop all services
./scripts/dev-stop.sh

# Restart specific service
./scripts/dev-restart.sh SERVICE_NAME

# View service logs
./scripts/dev-logs.sh SERVICE_NAME

# Execute command in service
./scripts/dev-exec.sh SERVICE_NAME COMMAND
```

#### Database Management Scripts
```bash
# Run migrations
./scripts/migrate.sh migrate

# Rollback migration
./scripts/migrate.sh rollback

# Seed development data
./scripts/seed-dev-data.sh

# Reset database
./scripts/reset-database.sh
```

### Development Utilities

#### Service Health Check
```bash
# Check all services
./scripts/health-check.sh

# Check specific service
./scripts/health-check.sh SERVICE_NAME

# Check service dependencies
./scripts/check-dependencies.sh
```

#### Log Analysis
```bash
# View recent logs
./scripts/view-logs.sh

# Search logs
./scripts/search-logs.sh "error\|exception"

# Monitor logs in real-time
./scripts/monitor-logs.sh
```

## Testing Setup

### Unit Testing

#### Test Environment Setup
```bash
# Install test dependencies
npm install --dev

# Run unit tests
npm test

# Run tests with coverage
npm run test:coverage

# Run specific test file
npm test -- --grep "test description"
```

#### Test Configuration
```bash
# Configure test environment
cp .env.test.example .env.test

# Edit test configuration
nano .env.test

# Set test-specific variables
NODE_ENV=test
DATABASE_URL=postgresql://postgres:password@localhost:5432/chitlaq_test
REDIS_URL=redis://localhost:6379/1
```

### Integration Testing

#### Integration Test Setup
```bash
# Start test services
docker compose -f docker-compose.test.yml up -d

# Run integration tests
npm run test:integration

# Run specific integration test
npm run test:integration -- --grep "integration test description"
```

#### Test Data Setup
```bash
# Create test database
docker compose exec postgres psql -U postgres -c "CREATE DATABASE chitlaq_test;"

# Run test migrations
docker compose exec postgres psql -U postgres -d chitlaq_test -f /opt/chitlaq/migrations/001_initial_schema.sql

# Seed test data
docker compose exec postgres psql -U postgres -d chitlaq_test -f /opt/chitlaq/seed-data/test-data.sql
```

### End-to-End Testing

#### E2E Test Setup
```bash
# Install E2E test dependencies
npm install --dev playwright

# Run E2E tests
npm run test:e2e

# Run E2E tests in headed mode
npm run test:e2e -- --headed

# Run specific E2E test
npm run test:e2e -- --grep "E2E test description"
```

#### E2E Test Configuration
```bash
# Configure E2E test environment
cp playwright.config.js.example playwright.config.js

# Edit E2E configuration
nano playwright.config.js

# Set E2E-specific variables
BASE_URL=http://localhost:3000
API_BASE_URL=http://localhost:3001
```

## Debugging Setup

### Application Debugging

#### Node.js Debugging
```bash
# Start service with debugging
docker compose exec api-gateway node --inspect=0.0.0.0:9229 app.js

# Connect debugger
# Use VS Code debugger or Chrome DevTools
# Connect to localhost:9229
```

#### Database Debugging
```bash
# Connect to database
docker compose exec postgres psql -U postgres -d chitlaq_dev

# Enable query logging
ALTER SYSTEM SET log_statement = 'all';
ALTER SYSTEM SET log_min_duration_statement = 0;
SELECT pg_reload_conf();

# View query logs
docker compose logs postgres | grep "LOG:"
```

### Performance Debugging

#### Performance Monitoring
```bash
# Monitor system resources
htop
iostat 1 5
free -h

# Monitor Docker resources
docker stats --no-stream

# Monitor application performance
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(http_request_duration_seconds_bucket[5m]))" | jq .
```

#### Profiling
```bash
# Profile Node.js application
docker compose exec api-gateway node --prof app.js

# Analyze profile
docker compose exec api-gateway node --prof-process isolate-*.log
```

### Log Analysis

#### Log Aggregation
```bash
# View all logs
docker compose logs --tail=100

# View specific service logs
docker compose logs SERVICE_NAME --tail=100

# Search logs
docker compose logs | grep -i "error\|exception"

# Monitor logs in real-time
docker compose logs -f
```

#### Log Analysis Tools
```bash
# Install log analysis tools
sudo apt install jq

# Parse JSON logs
docker compose logs SERVICE_NAME | jq .

# Filter logs by level
docker compose logs SERVICE_NAME | jq 'select(.level == "error")'

# Count log entries
docker compose logs SERVICE_NAME | jq -s 'length'
```

## Common Issues

### Service Startup Issues

#### Problem: Service Won't Start
**Symptoms:**
- Service exits immediately
- Error messages in logs
- Port conflicts

**Solutions:**
```bash
# Check service logs
docker compose logs SERVICE_NAME

# Check port conflicts
sudo netstat -tuln | grep PORT_NUMBER

# Check service configuration
docker compose config

# Restart service
docker compose restart SERVICE_NAME
```

#### Problem: Database Connection Issues
**Symptoms:**
- Connection refused errors
- Authentication failures
- Timeout errors

**Solutions:**
```bash
# Check database status
docker compose exec postgres pg_isready -U postgres

# Check database logs
docker compose logs postgres

# Verify database credentials
docker compose exec postgres psql -U postgres -c "SELECT current_user;"

# Restart database
docker compose restart postgres
```

### Development Environment Issues

#### Problem: Environment Variables Not Loading
**Symptoms:**
- Configuration errors
- Service startup failures
- Missing environment variables

**Solutions:**
```bash
# Check environment file
cat .env

# Verify environment variables
docker compose config

# Check service environment
docker compose exec SERVICE_NAME env

# Restart services
docker compose restart
```

#### Problem: Hot Reload Not Working
**Symptoms:**
- Changes not reflected
- Service not restarting
- File watching issues

**Solutions:**
```bash
# Check file permissions
ls -la /opt/chitlaq/

# Check volume mounts
docker compose config | grep volumes

# Restart development services
docker compose restart

# Check file watching
docker compose exec SERVICE_NAME ls -la /app/
```

### Testing Issues

#### Problem: Tests Failing
**Symptoms:**
- Test failures
- Timeout errors
- Database connection issues

**Solutions:**
```bash
# Check test environment
cat .env.test

# Verify test database
docker compose exec postgres psql -U postgres -d chitlaq_test -c "SELECT 1;"

# Run tests with verbose output
npm test -- --verbose

# Check test logs
npm test -- --reporter spec
```

#### Problem: Integration Tests Failing
**Symptoms:**
- Service connection issues
- Test data problems
- Environment mismatches

**Solutions:**
```bash
# Check test services
docker compose -f docker-compose.test.yml ps

# Verify test data
docker compose exec postgres psql -U postgres -d chitlaq_test -c "SELECT count(*) FROM users;"

# Run integration tests with debug
npm run test:integration -- --debug

# Check test logs
docker compose -f docker-compose.test.yml logs
```

## Conclusion

This local development setup guide provides comprehensive instructions for setting up a complete development environment for the ChitLaq M1 MVP infrastructure. Following these procedures ensures developers can quickly get started with local development, testing, and debugging.

Key development principles:
1. **Consistency**: Standardized development environment
2. **Isolation**: Separate development and production environments
3. **Automation**: Automated setup and testing procedures
4. **Documentation**: Clear and comprehensive documentation
5. **Debugging**: Effective debugging and troubleshooting tools

Regular review and updates of this guide ensure it remains current and effective for development operations.

---

**Document Version**: 1.0  
**Last Updated**: 2024  
**Next Review**: Monthly  
**Maintained by**: ChitLaq Development Team
