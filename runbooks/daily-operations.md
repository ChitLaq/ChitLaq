# ChitLaq M1 MVP - Daily Operations Runbook

> **Generated by PROMPT 1.7** - Infrastructure Documentation & Knowledge Transfer  
> **Senior Technical Writer & Infrastructure Architect** - 15+ years system documentation and knowledge transfer experience

## Executive Summary

This runbook provides comprehensive daily operational procedures for the ChitLaq M1 MVP infrastructure. It serves as a step-by-step guide for operations team members to perform routine maintenance, monitoring, and troubleshooting tasks. This document ensures consistent operations and helps maintain system reliability and performance.

## Table of Contents
- [Daily Checklist](#daily-checklist)
- [System Health Monitoring](#system-health-monitoring)
- [Service Status Checks](#service-status-checks)
- [Performance Monitoring](#performance-monitoring)
- [Log Review and Analysis](#log-review-and-analysis)
- [Backup Verification](#backup-verification)
- [Security Monitoring](#security-monitoring)
- [Incident Response](#incident-response)
- [Maintenance Tasks](#maintenance-tasks)
- [Escalation Procedures](#escalation-procedures)

## Daily Checklist

### Morning Routine (9:00 AM)

#### 1. System Health Overview
```bash
# Check system uptime and load
uptime
w
htop

# Check disk space
df -h
du -sh /var/lib/docker

# Check memory usage
free -h
cat /proc/meminfo | grep -E "(MemTotal|MemFree|MemAvailable)"

# Check network connectivity
ping -c 3 google.com
ping -c 3 your-domain.com
```

#### 2. Service Status Verification
```bash
# Check Docker services
docker compose ps
docker stats --no-stream

# Check individual service health
curl -s http://localhost:3001/health | jq .
curl -s http://localhost:3002/health | jq .
curl -s http://localhost:3003/health | jq .
curl -s http://localhost:3004/health | jq .
curl -s http://localhost:3005/health | jq .

# Check database connectivity
docker compose exec postgres psql -U postgres -c "SELECT 1;"

# Check Redis connectivity
docker compose exec redis redis-cli ping
```

#### 3. Monitoring Dashboard Review
```bash
# Access monitoring dashboards
# Grafana: http://your-domain.com:3000
# Prometheus: http://your-domain.com:9090
# Alertmanager: http://your-domain.com:9093

# Check for active alerts
curl -s http://localhost:9093/api/v1/alerts | jq '.data[] | select(.status.state == "active")'
```

### Midday Check (1:00 PM)

#### 1. Performance Metrics Review
```bash
# Check API response times
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(http_request_duration_seconds_bucket[5m]))" | jq .

# Check database performance
curl -s "http://localhost:9090/api/v1/query?query=postgresql_query_duration_seconds" | jq .

# Check WebSocket connections
curl -s "http://localhost:9090/api/v1/query?query=websocket_connections_active" | jq .
```

#### 2. Error Rate Analysis
```bash
# Check error rates
curl -s "http://localhost:9090/api/v1/query?query=rate(http_requests_total{status=~'5..'}[5m])" | jq .

# Check failed requests
curl -s "http://localhost:9090/api/v1/query?query=rate(http_requests_total{status=~'4..'}[5m])" | jq .
```

### Evening Routine (6:00 PM)

#### 1. Daily Summary
```bash
# Generate daily report
./scripts/daily-report.sh

# Check backup status
ls -la /opt/backups/chitlaq/ | tail -5

# Review security logs
sudo journalctl -u fail2ban --since "24 hours ago" | tail -20
```

#### 2. Capacity Planning
```bash
# Check resource utilization trends
curl -s "http://localhost:9090/api/v1/query?query=node_cpu_seconds_total" | jq .
curl -s "http://localhost:9090/api/v1/query?query=node_memory_MemAvailable_bytes" | jq .
curl -s "http://localhost:9090/api/v1/query?query=node_filesystem_avail_bytes" | jq .
```

## System Health Monitoring

### 1. Resource Monitoring

#### CPU Monitoring
```bash
# Check CPU usage
top -bn1 | grep "Cpu(s)"
iostat -c 1 5

# Check load average
uptime
cat /proc/loadavg

# Check for high CPU processes
ps aux --sort=-%cpu | head -10
```

#### Memory Monitoring
```bash
# Check memory usage
free -h
cat /proc/meminfo | grep -E "(MemTotal|MemFree|MemAvailable|Buffers|Cached)"

# Check memory by process
ps aux --sort=-%mem | head -10

# Check for memory leaks
docker stats --no-stream
```

#### Disk Monitoring
```bash
# Check disk usage
df -h
du -sh /var/lib/docker
du -sh /opt/backups/chitlaq

# Check disk I/O
iostat -x 1 5
iotop -o

# Check for large files
find /var/lib/docker -type f -size +100M -exec ls -lh {} \;
```

#### Network Monitoring
```bash
# Check network interfaces
ip addr show
ip route show

# Check network statistics
cat /proc/net/dev
ss -tuln

# Check bandwidth usage
iftop -i eth0
```

### 2. Service Health Monitoring

#### Docker Services
```bash
# Check Docker daemon status
sudo systemctl status docker

# Check container status
docker compose ps
docker ps -a

# Check container resource usage
docker stats --no-stream

# Check Docker logs
docker compose logs --tail=50
```

#### Database Health
```bash
# Check PostgreSQL status
docker compose exec postgres pg_isready -U postgres

# Check database connections
docker compose exec postgres psql -U postgres -c "SELECT count(*) FROM pg_stat_activity;"

# Check database size
docker compose exec postgres psql -U postgres -c "SELECT pg_size_pretty(pg_database_size('chitlaq'));"

# Check slow queries
docker compose exec postgres psql -U postgres -c "SELECT query, mean_time, calls FROM pg_stat_statements WHERE mean_time > 1000 ORDER BY mean_time DESC LIMIT 10;"
```

#### Redis Health
```bash
# Check Redis status
docker compose exec redis redis-cli ping

# Check Redis memory usage
docker compose exec redis redis-cli info memory

# Check Redis connections
docker compose exec redis redis-cli info clients

# Check Redis performance
docker compose exec redis redis-cli info stats
```

## Service Status Checks

### 1. API Gateway Health Check

#### Basic Health Check
```bash
# Check API Gateway health
curl -s http://localhost:3001/health | jq .

# Expected response:
# {
#   "status": "healthy",
#   "timestamp": "2024-01-01T12:00:00Z",
#   "version": "1.0.0",
#   "uptime": 86400
# }
```

#### Detailed Health Check
```bash
# Check API Gateway metrics
curl -s http://localhost:3001/metrics | grep -E "(http_requests_total|http_request_duration_seconds)"

# Check API Gateway logs
docker compose logs api-gateway --tail=20

# Test API endpoints
curl -s http://localhost:3001/api/health | jq .
```

### 2. WebSocket Service Health Check

#### WebSocket Health Check
```bash
# Check WebSocket service health
curl -s http://localhost:3002/health | jq .

# Test WebSocket connection
wscat -c ws://localhost:3002/ws -x '{"type":"ping"}'

# Check WebSocket metrics
curl -s http://localhost:3002/metrics | grep websocket
```

### 3. Feed Service Health Check

#### Feed Service Health Check
```bash
# Check Feed service health
curl -s http://localhost:3003/health | jq .

# Test feed endpoint
curl -s "http://localhost:3003/feed/home?page=1&limit=10" | jq .

# Check Feed service logs
docker compose logs feed-service --tail=20
```

### 4. Search Service Health Check

#### Search Service Health Check
```bash
# Check Search service health
curl -s http://localhost:3004/health | jq .

# Test search endpoint
curl -s "http://localhost:3004/search/users?q=test&page=1&limit=10" | jq .

# Check Search service logs
docker compose logs search-service --tail=20
```

### 5. Auth Service Health Check

#### Auth Service Health Check
```bash
# Check Auth service health
curl -s http://localhost:3005/health | jq .

# Test auth endpoint
curl -s http://localhost:3005/auth/status | jq .

# Check Auth service logs
docker compose logs auth-service --tail=20
```

## Performance Monitoring

### 1. API Performance Monitoring

#### Response Time Monitoring
```bash
# Check API response times
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(http_request_duration_seconds_bucket[5m]))" | jq .

# Check API throughput
curl -s "http://localhost:9090/api/v1/query?query=rate(http_requests_total[5m])" | jq .

# Check API error rates
curl -s "http://localhost:9090/api/v1/query?query=rate(http_requests_total{status=~'5..'}[5m])" | jq .
```

#### Endpoint Performance
```bash
# Check specific endpoint performance
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(http_request_duration_seconds_bucket{route='/api/feed/home'}[5m]))" | jq .

# Check authentication performance
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(http_request_duration_seconds_bucket{route='/api/auth/login'}[5m]))" | jq .
```

### 2. Database Performance Monitoring

#### Query Performance
```bash
# Check database query performance
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(postgresql_query_duration_seconds_bucket[5m]))" | jq .

# Check database connections
curl -s "http://localhost:9090/api/v1/query?query=postgresql_connections_active" | jq .

# Check database cache hit ratio
curl -s "http://localhost:9090/api/v1/query?query=postgresql_cache_hit_ratio" | jq .
```

#### Database Health Metrics
```bash
# Check database size
curl -s "http://localhost:9090/api/v1/query?query=postgresql_database_size_bytes" | jq .

# Check database locks
curl -s "http://localhost:9090/api/v1/query?query=postgresql_locks_count" | jq .

# Check database transactions
curl -s "http://localhost:9090/api/v1/query?query=rate(postgresql_transactions_total[5m])" | jq .
```

### 3. WebSocket Performance Monitoring

#### Connection Monitoring
```bash
# Check WebSocket connections
curl -s "http://localhost:9090/api/v1/query?query=websocket_connections_active" | jq .

# Check WebSocket message rate
curl -s "http://localhost:9090/api/v1/query?query=rate(websocket_messages_total[5m])" | jq .

# Check WebSocket latency
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(websocket_message_duration_seconds_bucket[5m]))" | jq .
```

## Log Review and Analysis

### 1. Application Logs

#### API Gateway Logs
```bash
# Check API Gateway logs
docker compose logs api-gateway --tail=100

# Check for errors
docker compose logs api-gateway | grep -i error | tail -20

# Check for slow requests
docker compose logs api-gateway | grep -i "slow\|timeout" | tail -20
```

#### WebSocket Logs
```bash
# Check WebSocket logs
docker compose logs websocket --tail=100

# Check for connection issues
docker compose logs websocket | grep -i "connection\|disconnect" | tail -20

# Check for message errors
docker compose logs websocket | grep -i "error\|failed" | tail -20
```

#### Database Logs
```bash
# Check PostgreSQL logs
docker compose logs postgres --tail=100

# Check for slow queries
docker compose logs postgres | grep -i "slow\|timeout" | tail -20

# Check for connection issues
docker compose logs postgres | grep -i "connection\|disconnect" | tail -20
```

### 2. System Logs

#### System Logs
```bash
# Check system logs
sudo journalctl --since "24 hours ago" | tail -50

# Check for errors
sudo journalctl --since "24 hours ago" -p err | tail -20

# Check for warnings
sudo journalctl --since "24 hours ago" -p warning | tail -20
```

#### Security Logs
```bash
# Check authentication logs
sudo journalctl -u ssh --since "24 hours ago" | tail -20

# Check Fail2ban logs
sudo journalctl -u fail2ban --since "24 hours ago" | tail -20

# Check audit logs
sudo ausearch -ts today | tail -20
```

### 3. Nginx Logs

#### Access Logs
```bash
# Check Nginx access logs
docker compose logs nginx | grep -E "GET|POST|PUT|DELETE" | tail -20

# Check for high traffic
docker compose logs nginx | grep -E "GET|POST" | awk '{print $1}' | sort | uniq -c | sort -nr | head -10

# Check for errors
docker compose logs nginx | grep -E "4[0-9][0-9]|5[0-9][0-9]" | tail -20
```

#### Error Logs
```bash
# Check Nginx error logs
docker compose logs nginx | grep -i error | tail -20

# Check for SSL errors
docker compose logs nginx | grep -i ssl | tail -20
```

## Backup Verification

### 1. Database Backup Verification

#### Check Backup Status
```bash
# Check backup directory
ls -la /opt/backups/chitlaq/

# Check latest backup
ls -la /opt/backups/chitlaq/ | tail -5

# Verify backup integrity
./backup-scripts/verify-backup.sh /opt/backups/chitlaq/latest_backup.sql
```

#### Test Backup Restoration
```bash
# Test backup restoration (on test database)
./backup-scripts/test-restore.sh /opt/backups/chitlaq/latest_backup.sql

# Verify restored data
docker compose exec postgres psql -U postgres -d chitlaq_test -c "SELECT count(*) FROM users;"
```

### 2. Configuration Backup Verification

#### Check Configuration Backups
```bash
# Check configuration backup
ls -la /opt/backups/chitlaq/config_*.tar.gz

# Verify configuration backup
tar -tzf /opt/backups/chitlaq/config_latest.tar.gz
```

## Security Monitoring

### 1. Security Log Review

#### Authentication Monitoring
```bash
# Check failed login attempts
sudo journalctl -u ssh --since "24 hours ago" | grep -i "failed\|invalid" | tail -20

# Check successful logins
sudo journalctl -u ssh --since "24 hours ago" | grep -i "accepted" | tail -20
```

#### Intrusion Detection
```bash
# Check Fail2ban status
sudo fail2ban-client status

# Check banned IPs
sudo fail2ban-client status sshd

# Check Fail2ban logs
sudo journalctl -u fail2ban --since "24 hours ago" | tail -20
```

### 2. Security Metrics

#### Security Metrics
```bash
# Check security metrics
curl -s "http://localhost:9090/api/v1/query?query=rate(fail2ban_banned_total[5m])" | jq .

# Check authentication metrics
curl -s "http://localhost:9090/api/v1/query?query=rate(auth_attempts_total[5m])" | jq .

# Check SSL certificate expiry
curl -s "http://localhost:9090/api/v1/query?query=ssl_certificate_expiry_seconds" | jq .
```

## Incident Response

### 1. Incident Detection

#### Alert Response
```bash
# Check active alerts
curl -s http://localhost:9093/api/v1/alerts | jq '.data[] | select(.status.state == "active")'

# Check alert history
curl -s http://localhost:9093/api/v1/alerts | jq '.data[] | select(.status.state == "resolved")' | tail -10
```

#### Service Outage Response
```bash
# Check service status
docker compose ps

# Check service logs
docker compose logs --tail=50

# Restart failed services
docker compose restart SERVICE_NAME
```

### 2. Incident Investigation

#### Performance Issues
```bash
# Check system resources
htop
iostat 1 5
free -h

# Check service performance
docker stats --no-stream

# Check database performance
docker compose exec postgres psql -U postgres -c "SELECT * FROM pg_stat_activity WHERE state = 'active';"
```

#### Error Investigation
```bash
# Check error logs
docker compose logs | grep -i error | tail -20

# Check system logs
sudo journalctl --since "1 hour ago" -p err

# Check network connectivity
ping -c 3 your-domain.com
telnet your-domain.com 443
```

## Maintenance Tasks

### 1. Daily Maintenance

#### Log Rotation
```bash
# Check log rotation status
sudo logrotate -d /etc/logrotate.conf

# Force log rotation
sudo logrotate -f /etc/logrotate.conf
```

#### Disk Cleanup
```bash
# Clean up Docker
docker system prune -f

# Clean up old backups
find /opt/backups/chitlaq -name "*.sql" -mtime +30 -delete

# Clean up old logs
find /var/log -name "*.log" -mtime +7 -delete
```

### 2. Weekly Maintenance

#### System Updates
```bash
# Update package list
sudo apt update

# Check for updates
sudo apt list --upgradable

# Update packages (if needed)
sudo apt upgrade -y
```

#### Security Updates
```bash
# Check security updates
sudo apt audit

# Update security packages
sudo apt upgrade -y
```

### 3. Monthly Maintenance

#### Performance Review
```bash
# Run performance benchmark
./scripts/benchmark.sh

# Review performance metrics
curl -s "http://localhost:9090/api/v1/query?query=histogram_quantile(0.95,rate(http_request_duration_seconds_bucket[30d]))" | jq .
```

#### Capacity Planning
```bash
# Check resource trends
df -h
free -h
uptime

# Check growth trends
curl -s "http://localhost:9090/api/v1/query?query=rate(user_registrations_total[30d])" | jq .
```

## Escalation Procedures

### 1. Severity Levels

#### Critical (P0)
- **Criteria**: Service completely down, data loss, security breach
- **Response Time**: Immediate (within 15 minutes)
- **Escalation**: On-call engineer → Team lead → CTO

#### High (P1)
- **Criteria**: Service degraded, performance issues, partial outage
- **Response Time**: 1 hour
- **Escalation**: On-call engineer → Team lead

#### Medium (P2)
- **Criteria**: Minor issues, non-critical bugs, performance degradation
- **Response Time**: 4 hours
- **Escalation**: On-call engineer

#### Low (P3)
- **Criteria**: Feature requests, minor bugs, documentation issues
- **Response Time**: 24 hours
- **Escalation**: Regular support

### 2. Escalation Contacts

#### Primary Contacts
- **On-call Engineer**: +1-XXX-XXX-XXXX
- **Team Lead**: +1-XXX-XXX-XXXX
- **CTO**: +1-XXX-XXX-XXXX

#### Secondary Contacts
- **DevOps Team**: devops@chitlaq.com
- **Security Team**: security@chitlaq.com
- **Infrastructure Team**: infrastructure@chitlaq.com

### 3. Communication Channels

#### Internal Communication
- **Slack**: #incidents channel
- **Email**: incidents@chitlaq.com
- **Phone**: Emergency hotline

#### External Communication
- **Status Page**: https://status.chitlaq.com
- **Twitter**: @ChitLaqStatus
- **Email**: status@chitlaq.com

## Conclusion

This daily operations runbook provides comprehensive procedures for maintaining the ChitLaq M1 MVP infrastructure. Following these procedures ensures consistent operations, early problem detection, and effective incident response.

Key operational principles:
1. **Proactive Monitoring**: Regular health checks and performance monitoring
2. **Systematic Approach**: Follow checklists and procedures consistently
3. **Documentation**: Record all actions and observations
4. **Communication**: Keep stakeholders informed of system status
5. **Continuous Improvement**: Learn from incidents and improve procedures

Regular review and updates of this runbook ensure it remains current and effective for operations team members.

---

**Document Version**: 1.0  
**Last Updated**: 2024  
**Next Review**: Weekly  
**Maintained by**: ChitLaq Operations Team
